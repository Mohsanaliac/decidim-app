{"ast":null,"code":"function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}\nfunction ownKeys(e, r) {\n  var t = Object.keys(e);\n  if (Object.getOwnPropertySymbols) {\n    var o = Object.getOwnPropertySymbols(e);\n    r && (o = o.filter(function (r) {\n      return Object.getOwnPropertyDescriptor(e, r).enumerable;\n    })), t.push.apply(t, o);\n  }\n  return t;\n}\nfunction _objectSpread(e) {\n  for (var r = 1; r < arguments.length; r++) {\n    var t = null != arguments[r] ? arguments[r] : {};\n    r % 2 ? ownKeys(Object(t), !0).forEach(function (r) {\n      _defineProperty(e, r, t[r]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) {\n      Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r));\n    });\n  }\n  return e;\n}\nfunction _defineProperty(e, r, t) {\n  return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: !0,\n    configurable: !0,\n    writable: !0\n  }) : e[r] = t, e;\n}\nfunction _toPropertyKey(t) {\n  var i = _toPrimitive(t, \"string\");\n  return \"symbol\" == _typeof(i) ? i : i + \"\";\n}\nfunction _toPrimitive(t, r) {\n  if (\"object\" != _typeof(t) || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != _typeof(i)) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\n/* eslint-disable require-jsdoc, no-console */\n\nimport areachart from \"src/decidim/vizzs/areachart\";\n$(function () {\n  var metricsData = {};\n  var metricsContainer = {};\n  var metricsParams = {};\n  var query = function query() {\n    var metricsQuery = \"metrics(names: \".concat(metricsParams.names, \", space_type: \\\"\").concat(metricsParams.spaceType, \"\\\", space_id: \").concat(metricsParams.spaceId, \") { name history { key value } }\");\n    return {\n      query: \"{ \".concat(metricsQuery, \" }\")\n    };\n  };\n  var parameterize = function parameterize(metrics) {\n    metricsParams.names = JSON.stringify(metrics || []);\n    metricsParams.spaceType = $(\"#metrics #metrics-space_type\").val() || null;\n    metricsParams.spaceId = $(\"#metrics #metrics-space_id\").val() || null;\n  };\n  var fetch = function fetch(metrics) {\n    return $.post(window.Decidim.config.get(\"api_path\"), query(metrics));\n  };\n  var downloadMetricData = function downloadMetricData(event) {\n    event.preventDefault();\n    var metricName = $(event.target).parents(\".metric-downloader\").data(\"metric\");\n    var csvContent = \"data:text/csv;charset=utf-8,\";\n    csvContent += \"key,value\\r\\n\";\n    metricsData[metricName].forEach(function (metricData) {\n      csvContent += \"\".concat(metricData.key, \",\").concat(metricData.value, \"\\r\\n\");\n    });\n\n    // Required for FF\n    var link = document.createElement(\"a\");\n    link.setAttribute(\"href\", encodeURI(csvContent));\n    link.setAttribute(\"download\", \"\".concat(metricName, \"_metric_data.csv\"));\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n  $(\".metric-chart:visible\").each(function (_index, container) {\n    metricsContainer[$(container).data(\"metric\")] = container;\n  });\n  $(\".metric-downloader\").each(function (_index, container) {\n    container.onclick = downloadMetricData;\n  });\n  if (!$.isEmptyObject(metricsContainer)) {\n    parameterize(Object.keys(metricsContainer));\n    fetch().then(function (response) {\n      if (response.data) {\n        $.each(response.data.metrics, function (_index, metricData) {\n          var container = metricsContainer[metricData.name];\n          if (metricData.history.length === 0) {\n            $(container).remove();\n            return;\n          }\n          var info = $(container).data(\"info\");\n          metricsData[metricData.name] = $.extend(true, [], metricData.history);\n          areachart(_objectSpread({\n            container: \"#\".concat(container.id),\n            data: metricData.history,\n            title: info.title,\n            objectName: info.object\n          }, $(container).data()));\n        });\n      } else if (response.errors) {\n        console.log(\"Something wrong happened when fetching metrics:\");\n        $.each(response.errors, function (_index, error) {\n          console.log(error.message);\n        });\n        $(\"#metrics\").remove();\n      }\n    }).fail(function (err) {\n      console.log(\"Something wrong happened when fetching metrics: \".concat(err.statusText));\n      $(\"#metrics\").remove();\n    });\n  }\n});","map":{"version":3,"names":["areachart","$","metricsData","metricsContainer","metricsParams","query","metricsQuery","concat","names","spaceType","spaceId","parameterize","metrics","JSON","stringify","val","fetch","post","window","Decidim","config","get","downloadMetricData","event","preventDefault","metricName","target","parents","data","csvContent","forEach","metricData","key","value","link","document","createElement","setAttribute","encodeURI","body","appendChild","click","removeChild","each","_index","container","onclick","isEmptyObject","Object","keys","then","response","name","history","length","remove","info","extend","_objectSpread","id","title","objectName","object","errors","console","log","error","message","fail","err","statusText"],"sources":["/home/mohsan/.rbenv/versions/3.0.6/lib/ruby/gems/3.0.0/gems/decidim-core-0.27.10/app/packs/src/decidim/vizzs/index.js"],"sourcesContent":["/* eslint-disable require-jsdoc, no-console */\n\nimport areachart from \"src/decidim/vizzs/areachart\"\n\n$(() => {\n\n  const metricsData = {};\n  const metricsContainer = {};\n  const metricsParams = {};\n\n  const query = () => {\n    let metricsQuery = `metrics(names: ${metricsParams.names}, space_type: \"${metricsParams.spaceType}\", space_id: ${metricsParams.spaceId}) { name history { key value } }`;\n    return {query: `{ ${metricsQuery} }`};\n  }\n\n  const parameterize = (metrics) => {\n    metricsParams.names = JSON.stringify(metrics || []);\n    metricsParams.spaceType = $(\"#metrics #metrics-space_type\").val() || null;\n    metricsParams.spaceId = $(\"#metrics #metrics-space_id\").val() || null;\n  }\n\n  const fetch = (metrics) => $.post(window.Decidim.config.get(\"api_path\"), query(metrics));\n\n  const downloadMetricData = (event) => {\n    event.preventDefault();\n    let metricName = $(event.target).parents(\".metric-downloader\").data(\"metric\");\n    let csvContent = \"data:text/csv;charset=utf-8,\";\n\n    csvContent += \"key,value\\r\\n\";\n    metricsData[metricName].forEach((metricData)  => {\n      csvContent += `${metricData.key},${metricData.value}\\r\\n`;\n    });\n\n    // Required for FF\n    let link = document.createElement(\"a\");\n    link.setAttribute(\"href\", encodeURI(csvContent));\n    link.setAttribute(\"download\", `${metricName}_metric_data.csv`);\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  }\n\n  $(\".metric-chart:visible\").each((_index, container) => {\n    metricsContainer[$(container).data(\"metric\")] = container;\n  });\n  $(\".metric-downloader\").each((_index, container) => {\n    container.onclick = downloadMetricData;\n  });\n\n  if (!$.isEmptyObject(metricsContainer)) {\n    parameterize(Object.keys(metricsContainer))\n    fetch().then((response) => {\n      if (response.data) {\n        $.each(response.data.metrics, (_index, metricData) => {\n          let container = metricsContainer[metricData.name];\n          if (metricData.history.length === 0) {\n            $(container).remove();\n            return;\n          }\n          let info = $(container).data(\"info\");\n          metricsData[metricData.name] = $.extend(true, [], metricData.history);\n          areachart({\n            container: `#${container.id}`,\n            data: metricData.history,\n            title: info.title,\n            objectName: info.object,\n            ...$(container).data()\n          });\n        });\n      } else if (response.errors) {\n        console.log(\"Something wrong happened when fetching metrics:\");\n        $.each(response.errors, (_index, error) => {\n          console.log(error.message);\n        });\n        $(\"#metrics\").remove();\n      }\n    }).fail((err) => {\n      console.log(`Something wrong happened when fetching metrics: ${err.statusText}`);\n      $(\"#metrics\").remove();\n    });\n  }\n});\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}