{"ast":null,"code":"import \"src/decidim/geocoding\";\nimport formatAddress from \"src/decidim/geocoding/format_address\";\n\n/**\n * For the available address format keys, refer to:\n * https://developer.here.com/documentation/geocoder-autocomplete/dev_guide/topics/resource-type-response-suggest.html\n */\n$(function () {\n  var generateAddressLabel = formatAddress;\n  $(\"[data-decidim-geocoding]\").each(function (_i, el) {\n    var $input = $(el);\n    var config = $input.data(\"decidim-geocoding\");\n    var queryMinLength = config.queryMinLength || 2;\n    var addressFormat = config.addressFormat || [[\"street\", \"houseNumber\"], \"district\", \"city\", \"county\", \"state\", \"country\"];\n    var language = $(\"html\").attr(\"lang\");\n    var currentSuggestionQuery = null;\n    if (!config.apiKey || config.apiKey.length < 1) {\n      return;\n    }\n    $input.on(\"geocoder-suggest.decidim\", function (_ev, query, callback) {\n      clearTimeout(currentSuggestionQuery);\n\n      // Do not trigger API calls on short queries\n      if (\"\".concat(query).trim().length < queryMinLength) {\n        return;\n      }\n      // Changes to the autocomplete api call based on:\n      // https://developer.here.com/documentation/geocoding-search-api/migration_guide/migration-geocoder/topics-api/autocomplete.html\n      currentSuggestionQuery = setTimeout(function () {\n        $.ajax({\n          method: \"GET\",\n          url: \"https://autocomplete.search.hereapi.com/v1/autocomplete\",\n          data: {\n            apiKey: config.apiKey,\n            // eslint-disable-next-line\n            q: query,\n            lang: language\n          },\n          dataType: \"json\"\n        }).done(function (resp) {\n          if (resp.items) {\n            return callback(resp.items.map(function (item) {\n              var label = generateAddressLabel(item.address, addressFormat);\n              return {\n                key: label,\n                value: label,\n                locationId: item.id\n              };\n            }));\n          }\n          return null;\n        });\n      }, 200);\n    });\n    $input.on(\"geocoder-suggest-select.decidim\", function (_ev, selectedItem) {\n      $.ajax({\n        method: \"GET\",\n        url: \"https://lookup.search.hereapi.com/v1/lookup\",\n        data: {\n          apiKey: config.apiKey,\n          id: selectedItem.locationId\n        },\n        dataType: \"json\"\n      }).done(function (resp) {\n        if (!resp || Object.keys(resp).length < 1) {\n          return;\n        }\n        var position = resp.position;\n        if (!position || !position.lat || !position.lng) {\n          return;\n        }\n        var coordinates = [position.lat, position.lng];\n        $input.trigger(\"geocoder-suggest-coordinates.decidim\", [coordinates]);\n      });\n    });\n  });\n});","map":{"version":3,"names":["formatAddress","$","generateAddressLabel","each","_i","el","$input","config","data","queryMinLength","addressFormat","language","attr","currentSuggestionQuery","apiKey","length","on","_ev","query","callback","clearTimeout","concat","trim","setTimeout","ajax","method","url","q","lang","dataType","done","resp","items","map","item","label","address","key","value","locationId","id","selectedItem","Object","keys","position","lat","lng","coordinates","trigger"],"sources":["/home/mohsan/.rbenv/versions/3.0.6/lib/ruby/gems/3.0.0/gems/decidim-core-0.27.10/app/packs/src/decidim/geocoding/provider/here.js"],"sourcesContent":["import \"src/decidim/geocoding\"\nimport formatAddress from \"src/decidim/geocoding/format_address\"\n\n/**\n * For the available address format keys, refer to:\n * https://developer.here.com/documentation/geocoder-autocomplete/dev_guide/topics/resource-type-response-suggest.html\n */\n$(() => {\n  const generateAddressLabel = formatAddress;\n\n  $(\"[data-decidim-geocoding]\").each((_i, el) => {\n    const $input = $(el);\n    const config = $input.data(\"decidim-geocoding\");\n    const queryMinLength = config.queryMinLength || 2;\n    const addressFormat = config.addressFormat || [\n      [\"street\", \"houseNumber\"],\n      \"district\",\n      \"city\",\n      \"county\",\n      \"state\",\n      \"country\"\n    ];\n    const language = $(\"html\").attr(\"lang\");\n    let currentSuggestionQuery = null;\n\n    if (!config.apiKey || config.apiKey.length < 1) {\n      return;\n    }\n\n    $input.on(\"geocoder-suggest.decidim\", (_ev, query, callback) => {\n      clearTimeout(currentSuggestionQuery);\n\n      // Do not trigger API calls on short queries\n      if (`${query}`.trim().length < queryMinLength) {\n        return;\n      }\n      // Changes to the autocomplete api call based on:\n      // https://developer.here.com/documentation/geocoding-search-api/migration_guide/migration-geocoder/topics-api/autocomplete.html\n      currentSuggestionQuery = setTimeout(() => {\n        $.ajax({\n          method: \"GET\",\n          url: \"https://autocomplete.search.hereapi.com/v1/autocomplete\",\n          data: {\n            apiKey: config.apiKey,\n            // eslint-disable-next-line\n            q: query,\n            lang: language\n          },\n          dataType: \"json\"\n        }).done((resp) => {\n          if (resp.items) {\n            return callback(resp.items.map((item) => {\n              const label = generateAddressLabel(item.address, addressFormat);\n\n              return {\n                key: label,\n                value: label,\n                locationId: item.id\n              }\n            }));\n          }\n          return null;\n        });\n      }, 200);\n    });\n\n    $input.on(\"geocoder-suggest-select.decidim\", (_ev, selectedItem) => {\n      $.ajax({\n        method: \"GET\",\n        url: \"https://lookup.search.hereapi.com/v1/lookup\",\n        data: {\n          apiKey: config.apiKey,\n          id: selectedItem.locationId\n        },\n        dataType: \"json\"\n      }).done((resp) => {\n        if (!resp || Object.keys(resp).length < 1\n        ) {\n          return;\n        }\n        const position = resp.position;\n        if (!position || !position.lat || !position.lng) {\n          return\n        }\n        const coordinates = [\n          position.lat,\n          position.lng\n        ];\n\n        $input.trigger(\n          \"geocoder-suggest-coordinates.decidim\",\n          [coordinates]\n        );\n      });\n    });\n  })\n})\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}