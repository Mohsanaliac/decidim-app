{"ast":null,"code":"import UploadModal from \"src/decidim/direct_uploads/upload_modal\";\nimport { truncateFilename, createHiddenInput } from \"src/decidim/direct_uploads/upload_utility\";\nimport { escapeHtml } from \"src/decidim/utilities/text\";\nvar loadAttachments = function loadAttachments(modal) {\n  Array.from(modal.activeAttachments.children).forEach(function (child) {\n    var uploadItem = modal.createUploadItem(child.dataset.filename, child.dataset.title, \"validated\");\n    child.dataset.fileid = uploadItem.dataset.fileid;\n  });\n};\nvar addInputEventListener = function addInputEventListener(modal) {\n  modal.input.addEventListener(\"change\", function (event) {\n    event.preventDefault();\n    var files = event.target.files;\n    Array.from(files).forEach(function (file) {\n      return modal.uploadFile(file);\n    });\n  });\n};\nvar addButtonEventListener = function addButtonEventListener(modal) {\n  modal.button.addEventListener(\"click\", function (event) {\n    event.preventDefault();\n    Array.from(modal.trashCan.children).forEach(function (item) {\n      modal.uploadItems.append(item);\n    });\n    if (modal.uploadItems.children.length === 0) {\n      modal.modalTitle.innerHTML = modal.modalTitle.dataset.addlabel;\n    } else {\n      modal.modalTitle.innerHTML = modal.modalTitle.dataset.editlabel;\n    }\n    modal.updateDropZone();\n  });\n};\nvar addDropZoneEventListeners = function addDropZoneEventListeners(modal) {\n  modal.dropZone.addEventListener(\"dragenter\", function (event) {\n    event.preventDefault();\n  });\n  modal.dropZone.addEventListener(\"dragover\", function (event) {\n    event.preventDefault();\n    modal.dropZone.classList.add(\"is-dragover\");\n  });\n  modal.dropZone.addEventListener(\"dragleave\", function () {\n    modal.dropZone.classList.remove(\"is-dragover\");\n  });\n  modal.dropZone.addEventListener(\"drop\", function (event) {\n    event.preventDefault();\n    var files = event.dataTransfer.files;\n    Array.from(files).forEach(function (file) {\n      return modal.uploadFile(file);\n    });\n  });\n};\nvar addSaveButtonEventListener = function addSaveButtonEventListener(modal) {\n  modal.saveButton.addEventListener(\"click\", function (event) {\n    event.preventDefault();\n    var validatedItems = modal.uploadItems.querySelectorAll(\".upload-item[data-state='validated']\");\n    var validatedItemsCount = validatedItems.length;\n    validatedItems.forEach(function (item) {\n      var details = item.querySelector(\".attachment-details\");\n      if (details) {\n        modal.activeAttachments.appendChild(details);\n      } else {\n        details = modal.activeAttachments.querySelector(\".attachment-details[data-fileid='\".concat(item.dataset.fileid, \"'\"));\n      }\n      var span = details.querySelector(\"span\");\n      span.classList.add(\"filename\");\n      if (modal.options.titled) {\n        var title = item.querySelector(\"input[type='text']\").value;\n        details.dataset.title = title;\n        var hiddenTitle = details.querySelector(\".hidden-title\");\n        if (hiddenTitle) {\n          hiddenTitle.value = title;\n        } else {\n          var attachmentId = details.querySelector(\"[name='\".concat(modal.options.resourceName, \"[\").concat(modal.name, \"][]'\")).value;\n          var ordinalNumber = modal.getOrdinalNumber();\n          var hiddenTitleField = createHiddenInput(\"hidden-title\", \"\".concat(modal.options.resourceName, \"[\").concat(modal.options.addAttribute, \"][\").concat(ordinalNumber, \"][title]\"), title);\n          var hiddenIdField = createHiddenInput(\"hidden-id\", \"\".concat(modal.options.resourceName, \"[\").concat(modal.options.addAttribute, \"][\").concat(ordinalNumber, \"][id]\"), attachmentId);\n          details.appendChild(hiddenTitleField);\n          details.appendChild(hiddenIdField);\n        }\n        span.innerHTML = \"\".concat(escapeHtml(title), \" (\").concat(escapeHtml(truncateFilename(item.dataset.filename)), \")\");\n      } else {\n        span.innerHTML = escapeHtml(truncateFilename(item.dataset.filename, 19));\n      }\n      span.style.display = \"block\";\n    });\n    if (!modal.options.titled && modal.trashCan.children.length > 0) {\n      modal.activeAttachments.innerHTML = \"<input name='\".concat(modal.options.resourceName, \"[remove_\").concat(modal.name, \"]' type=\\\"hidden\\\" value=\\\"true\\\">\");\n    }\n    if (validatedItemsCount > 0) {\n      // Foundation helper does some magic with error fields, so these must be triggered using jQuery.\n      var $el = $(modal.uploadContainer.querySelector(\"input[type='checkbox']\"));\n      if ($el) {\n        $el.prop(\"checked\", true);\n        $el.trigger(\"change\");\n      }\n    }\n    modal.cleanTrashCan();\n    modal.updateAddAttachmentsButton();\n  });\n};\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n  var attachmentButtons = document.querySelectorAll(\"button.add-file\");\n  attachmentButtons.forEach(function (attachmentButton) {\n    var modal = new UploadModal(attachmentButton);\n    loadAttachments(modal);\n    addInputEventListener(modal);\n    addButtonEventListener(modal);\n    addDropZoneEventListeners(modal);\n    addSaveButtonEventListener(modal);\n  });\n});","map":{"version":3,"names":["UploadModal","truncateFilename","createHiddenInput","escapeHtml","loadAttachments","modal","Array","from","activeAttachments","children","forEach","child","uploadItem","createUploadItem","dataset","filename","title","fileid","addInputEventListener","input","addEventListener","event","preventDefault","files","target","file","uploadFile","addButtonEventListener","button","trashCan","item","uploadItems","append","length","modalTitle","innerHTML","addlabel","editlabel","updateDropZone","addDropZoneEventListeners","dropZone","classList","add","remove","dataTransfer","addSaveButtonEventListener","saveButton","validatedItems","querySelectorAll","validatedItemsCount","details","querySelector","appendChild","concat","span","options","titled","value","hiddenTitle","attachmentId","resourceName","name","ordinalNumber","getOrdinalNumber","hiddenTitleField","addAttribute","hiddenIdField","style","display","$el","$","uploadContainer","prop","trigger","cleanTrashCan","updateAddAttachmentsButton","document","attachmentButtons","attachmentButton"],"sources":["/home/mohsan/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/decidim-core-0.27.10/app/packs/src/decidim/direct_uploads/upload_field.js"],"sourcesContent":["import UploadModal from \"src/decidim/direct_uploads/upload_modal\";\nimport { truncateFilename, createHiddenInput } from \"src/decidim/direct_uploads/upload_utility\";\nimport { escapeHtml } from \"src/decidim/utilities/text\";\n\nconst loadAttachments = (modal) => {\n  Array.from(modal.activeAttachments.children).forEach((child) => {\n    const uploadItem = modal.createUploadItem(child.dataset.filename, child.dataset.title, \"validated\");\n    child.dataset.fileid = uploadItem.dataset.fileid;\n  })\n}\n\nconst addInputEventListener = (modal) => {\n  modal.input.addEventListener(\"change\", (event) => {\n    event.preventDefault();\n    const files = event.target.files;\n    Array.from(files).forEach((file) => modal.uploadFile(file));\n  })\n}\n\nconst addButtonEventListener = (modal) => {\n  modal.button.addEventListener(\"click\", (event) => {\n    event.preventDefault();\n    Array.from(modal.trashCan.children).forEach((item) => {\n      modal.uploadItems.append(item);\n    })\n    if (modal.uploadItems.children.length === 0) {\n      modal.modalTitle.innerHTML = modal.modalTitle.dataset.addlabel;\n    } else {\n      modal.modalTitle.innerHTML = modal.modalTitle.dataset.editlabel;\n    }\n    modal.updateDropZone();\n  })\n}\n\nconst addDropZoneEventListeners = (modal) => {\n  modal.dropZone.addEventListener(\"dragenter\", (event) => {\n    event.preventDefault();\n  })\n\n  modal.dropZone.addEventListener(\"dragover\", (event) => {\n    event.preventDefault();\n    modal.dropZone.classList.add(\"is-dragover\");\n  })\n\n  modal.dropZone.addEventListener(\"dragleave\", () => {\n    modal.dropZone.classList.remove(\"is-dragover\");\n  })\n\n  modal.dropZone.addEventListener(\"drop\", (event) => {\n    event.preventDefault();\n    const files = event.dataTransfer.files;\n    Array.from(files).forEach((file) => modal.uploadFile(file));\n  })\n}\n\nconst addSaveButtonEventListener = (modal) => {\n  modal.saveButton.addEventListener(\"click\", (event) => {\n    event.preventDefault();\n    const validatedItems = modal.uploadItems.querySelectorAll(\".upload-item[data-state='validated']\")\n    const validatedItemsCount = validatedItems.length;\n    validatedItems.forEach((item) => {\n      let details = item.querySelector(\".attachment-details\");\n      if (details) {\n        modal.activeAttachments.appendChild(details);\n      } else {\n        details = modal.activeAttachments.querySelector(`.attachment-details[data-fileid='${item.dataset.fileid}'`);\n      }\n      const span = details.querySelector(\"span\");\n      span.classList.add(\"filename\");\n      if (modal.options.titled) {\n        const title = item.querySelector(\"input[type='text']\").value;\n        details.dataset.title = title;\n        let hiddenTitle = details.querySelector(\".hidden-title\")\n        if (hiddenTitle) {\n          hiddenTitle.value = title;\n        } else {\n          const attachmentId = details.querySelector(`[name='${modal.options.resourceName}[${modal.name}][]'`).value\n          const ordinalNumber = modal.getOrdinalNumber()\n          const hiddenTitleField = createHiddenInput(\"hidden-title\", `${modal.options.resourceName}[${modal.options.addAttribute}][${ordinalNumber}][title]`, title)\n          const hiddenIdField = createHiddenInput(\"hidden-id\", `${modal.options.resourceName}[${modal.options.addAttribute}][${ordinalNumber}][id]`, attachmentId)\n          details.appendChild(hiddenTitleField);\n          details.appendChild(hiddenIdField);\n        }\n        span.innerHTML = `${escapeHtml(title)} (${escapeHtml(truncateFilename(item.dataset.filename))})`;\n      } else {\n        span.innerHTML = escapeHtml(truncateFilename(item.dataset.filename, 19));\n      }\n      span.style.display = \"block\";\n    });\n\n    if (!modal.options.titled && modal.trashCan.children.length > 0) {\n      modal.activeAttachments.innerHTML = `<input name='${modal.options.resourceName}[remove_${modal.name}]' type=\"hidden\" value=\"true\">`;\n    }\n\n    if (validatedItemsCount > 0) {\n      // Foundation helper does some magic with error fields, so these must be triggered using jQuery.\n      const $el = $(modal.uploadContainer.querySelector(\"input[type='checkbox']\"));\n      if ($el) {\n        $el.prop(\"checked\", true);\n        $el.trigger(\"change\");\n      }\n    }\n    modal.cleanTrashCan();\n    modal.updateAddAttachmentsButton();\n  });\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  const attachmentButtons = document.querySelectorAll(\"button.add-file\");\n\n  attachmentButtons.forEach((attachmentButton) => {\n    const modal = new UploadModal(attachmentButton);\n    loadAttachments(modal);\n    addInputEventListener(modal);\n    addButtonEventListener(modal);\n    addDropZoneEventListeners(modal);\n    addSaveButtonEventListener(modal);\n  })\n})\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}